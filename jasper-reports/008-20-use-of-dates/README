In this version I managed to:

[ i] automatically and automagically add REPORT_PARAMS parameters
     found in queries in the global scope.
[ii] implement the materialize function for queries that return
     parameters and values.

